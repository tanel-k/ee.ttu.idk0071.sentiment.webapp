{"version":3,"sources":["app.js","environment.js","lookup-form.js","lookup-result.js","main.js","messages.js","no-lookup.js","utils.js","web-api.js","resources/index.js","resources/elements/enhanced-select.js","resources/elements/loading-indicator.js"],"names":["App","api","configureRouter","config","router","title","map","route","moduleId","name","debug","testing","gatewayURL","LookupForm","ea","created","getBusinessTypes","then","types","x","value","id","unshift","getCountries","countries","code","performLookup","publish","blockPage","countryCode","countryId","businessTypeId","typeId","businessName","releasePage","navigate","lookupResult","isRequesting","$","blockUI","message","unblockUI","LookupResult","inject","subscribe","activate","params","getLookupData","lookupId","lookupData","getLookupSnapshots","snapshots","snapshotsResult","configure","Promise","warnings","wForgottenReturn","aurelia","use","standardConfiguration","feature","developmentLogging","plugin","start","setRoot","LookupStarted","NoLookup","isEmpty","val","trim","WebAPI","httpClient","useStandardConfiguration","withBaseUrl","fetch","response","json","business","method","body","JSON","stringify","headers","globalResources","EnhancedSelect","Element","defaultBindingMode","oneWay","twoWay","element","attached","selector","find","select2","on","event","detached","nprogress","LoadingIndicator","defaultValue","loadingChanged","newValue","done"],"mappings":"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","file":"app-bundle.js","sourcesContent":["/**\r\n * Created by Tanel.Prikk on 2/21/2017.\r\n * \r\n * 07/03/2017\tIDKPR-44: use injection\r\n */\r\nimport {inject} from 'aurelia-framework';\r\nimport {WebAPI} from './web-api';\r\n\r\n@inject(WebAPI)\r\nexport class App {\r\n\r\n\tconstructor(api) {\r\n\t\tthis.api = api;\r\n\t}\r\n\r\n\tconfigureRouter(config, router) {\r\n\t\tconfig.title = 'Sentimental.ly';\r\n\t\tconfig.map([\r\n\t\t\t{\r\n\t\t\t\troute: '',\r\n\t\t\t\tmoduleId: 'no-lookup', \r\n\t\t\t\ttitle: 'Lookups'\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\troute: 'lookups/:lookupId',\r\n\t\t\t\tmoduleId: 'lookup-result',\r\n\t\t\t\tname: 'lookups'\r\n\t\t\t}\r\n\t\t]);\r\n\r\n\t\tthis.router = router;\r\n\t}\r\n}\r\n","export default {\r\n\tdebug: true,\r\n\ttesting: true,\r\n\tgatewayURL: 'http://localhost:8080/'\r\n};\r\n","/**\r\n * Created by Tanel.Prikk on 2/21/2017.\r\n */\r\nimport {inject} from 'aurelia-framework';\r\nimport {WebAPI} from './web-api';\r\nimport {isEmpty} from './utils';\r\nimport {Router} from 'aurelia-router';\r\nimport {EventAggregator} from 'aurelia-event-aggregator';\r\nimport {LookupStarted} from './messages';\r\nimport 'jquery';\r\nimport blockUI from 'blockUI';\r\n\r\n@inject(WebAPI, Router, EventAggregator)\r\nexport class LookupForm {\r\n\tconstructor(api, router, ea) {\r\n\t\tthis.api = api;\r\n\t\tthis.router = router;\r\n\t\tthis.ea = ea;\r\n\t}\r\n\r\n\tcreated() {\r\n\t\tthis.api.getBusinessTypes().then(types => {\r\n\t\t\t\tthis.types = types.map(x => {\r\n\t\t\t\t\treturn { name: x.name, value: x.id };\r\n\t\t\t\t});\r\n\t\t\t\tthis.types.unshift({});\r\n\t\t\t});\r\n\r\n\t\tthis.api.getCountries().then(countries => {\r\n\t\t\t\tthis.countries = countries.map(x => {\r\n\t\t\t\t\treturn { name: x.name, value: x.code };\r\n\t\t\t});\r\n\t\t\tthis.countries.unshift({});\r\n\t\t});\r\n\t}\r\n\r\n\tget canLookup() {\r\n\t\treturn this.typeId\r\n\t\t\t&& this.countryId\r\n\t\t\t&& !isEmpty(this.businessName)\r\n\t\t\t&& !this.api.isRequesting();\r\n\t}\r\n\r\n\tperformLookup() {\r\n\t\tthis.ea.publish(new LookupStarted());\r\n\t\tblockPage();\r\n\t\t\r\n\t\tthis.api.performLookup({\r\n\t\t\tcountryCode: this.countryId,\r\n\t\t\tbusinessTypeId: this.typeId,\r\n\t\t\tbusinessName: this.businessName\r\n\t\t})\r\n\t\t.then(lookupResult => {\r\n\t\t\treleasePage();\r\n\t\t\tthis.router.navigate(\"lookups/\" + lookupResult.id);\r\n\t\t});\r\n\t}\r\n}\r\n\r\nfunction blockPage() {\r\n\t$.blockUI({ message: null });\r\n}\r\n\r\nfunction releasePage() {\r\n\t$.unblockUI();\r\n}","/**\r\n * Created by Tanel.Prikk on 2/21/2017.\r\n */\r\nimport {EventAggregator} from 'aurelia-event-aggregator';\r\nimport {LookupStarted} from './messages';\r\nimport {WebAPI} from './web-api';\r\n\r\nexport class LookupResult {\r\n  static inject() { return [WebAPI, EventAggregator]; }\r\n\r\n  constructor(api, ea){\r\n    this.api = api;\r\n    this.ea = ea;\r\n    this.ea.subscribe(LookupStarted, msg =>  {\r\n      // clear old results here\r\n    });\r\n  }\r\n\r\n  activate(params) {\r\n    this.api.getLookupData(params.lookupId).then(lookupData => {\r\n      this.lookupData = lookupData;\r\n    });\r\n\r\n    return this.api.getLookupSnapshots(params.lookupId).then(snapshotsResult => {\r\n      this.snapshots = snapshotsResult;\r\n    });\r\n  }\r\n}\r\n","import environment from './environment';\r\n\r\n//Configure Bluebird Promises.\r\nPromise.config({\r\n\twarnings: {\r\n\t\twForgottenReturn: false\r\n\t}\r\n});\r\n\r\nexport function configure(aurelia) {\r\n\taurelia.use\r\n\t\t.standardConfiguration()\r\n\t\t.feature('resources');\r\n\r\n\tif (environment.debug) {\r\n\t\taurelia.use.developmentLogging();\r\n\t}\r\n\r\n\tif (environment.testing) {\r\n\t\taurelia.use.plugin('aurelia-testing');\r\n\t}\r\n\r\n\taurelia.start().then(() => aurelia.setRoot());\r\n}\r\n","/**\r\n * Created by Tanel.Prikk on 2/21/2017.\r\n */\r\nexport class LookupStarted {\r\n\tconstructor(){\r\n\t\t// pass\r\n\t}\r\n}","/**\r\n * Created by Tanel.Prikk on 2/21/2017.\r\n */\r\nexport class NoLookup {\r\n\tconstructor() {\r\n\t\tthis.message = \"Use the form to see what other people think.\";\r\n\t}\r\n}\r\n","/**\r\n * Created by Tanel.Prikk on 2/21/2017.\r\n */\r\nexport function isEmpty(val) {\r\n\treturn !val || !val.trim();\r\n}\r\n","/**\r\n * Created by Tanel.Prikk on 2/21/2017.\r\n * \r\n * 07/03/2017\tIDKPR-44: use injection\r\n */\r\nimport {inject} from 'aurelia-framework';\r\nimport {HttpClient, json} from 'aurelia-fetch-client';\r\nimport environment from './environment';\r\n\r\n@inject(HttpClient)\r\nexport class WebAPI {\r\n\tconstructor(httpClient) {\r\n\t\tthis.httpClient = httpClient.configure(config => config\r\n\t\t\t\t\t.useStandardConfiguration()\r\n\t\t\t\t\t.withBaseUrl(environment.gatewayURL)\r\n\t\t\t\t);\r\n\t}\r\n\r\n\tisRequesting() {\r\n\t\treturn this.httpClient.isRequesting;\r\n\t}\r\n\r\n\tgetCountries() {\r\n\t\treturn this.httpClient\r\n\t\t\t.fetch('classifiers/countries')\r\n\t\t\t.then(response => { return response.json() });\r\n\t}\r\n\r\n\tgetBusinessTypes() {\r\n\t\treturn this.httpClient\r\n\t\t\t.fetch('classifiers/business-types')\r\n\t\t\t.then(response => { return response.json() });\r\n\t}\r\n\r\n\tgetLookupSnapshots(lookupId) {\r\n\t\treturn this.httpClient\r\n\t\t\t.fetch('lookups/' + lookupId + '/snapshots')\r\n\t\t\t.then(response => { return response.json() });\r\n\t}\r\n\r\n\tgetLookupData(lookupId) {\r\n\t\treturn this.httpClient\r\n\t\t\t.fetch('lookups/' + lookupId)\r\n\t\t\t.then(response => { return response.json() });\r\n\t}\r\n\r\n\tperformLookup(business) {\r\n\t\treturn this.httpClient\r\n\t\t.fetch('lookups', {\r\n\t\t\tmethod: 'POST',\r\n\t\t\tbody: JSON.stringify(business),\r\n\t\t\theaders: {\r\n\t\t\t'Content-type': 'application/json'\r\n\t\t\t}})\r\n\t\t.then(response => { return response.json() });\r\n\t}\r\n}\r\n","export function configure(config) {\r\n\tconfig.globalResources([\r\n\t\t'./elements/loading-indicator',\r\n\t\t'./elements/enhanced-select'\r\n\t]);\r\n}\r\n","import {bindable, bindingMode, inject} from 'aurelia-framework';\r\n\r\nimport 'jquery';\r\nimport select2 from 'select2';\r\n\r\n@inject(Element)\r\nexport class EnhancedSelect {\r\n\t@bindable({ defaultBindingMode: bindingMode.oneWay }) guid = '';\r\n\t@bindable({ defaultBindingMode: bindingMode.oneWay }) values;\r\n\t@bindable({ defaultBindingMode: bindingMode.twoWay }) value;\r\n\r\n\tconstructor(element) {\r\n\t\tthis.element = element;\r\n\t}\r\n\r\n\tattached() {\r\n\t\tthis.selector = $(this.element).find('select')\r\n\t\t\t.select2()\r\n\t\t\t.on('select2:select', (event) => {\r\n\t\t\t\tthis.value = $(this.element).find('select').select2('val');\r\n\t\t\t});\r\n\t}\r\n\t\r\n\tdetached() {\r\n\t\tthis.selector.select2('destroy');\r\n\t}\r\n}","/**\r\n * Created by Tanel.Prikk on 2/21/2017.\r\n */\r\nimport * as nprogress from 'nprogress';\r\nimport {bindable, noView, decorators} from 'aurelia-framework';\r\n\r\nexport let LoadingIndicator = decorators(\r\n\tnoView(['nprogress/nprogress.css']),\r\n\tbindable({name: 'loading', defaultValue: false})\r\n).on(class {\r\n\tloadingChanged(newValue){\r\n\t\tif (newValue) {\r\n\t\t\tnprogress.start();\r\n\t\t} else {\r\n\t\t\tnprogress.done();\r\n\t\t}\r\n\t}\r\n});\r\n"],"sourceRoot":"../src"}